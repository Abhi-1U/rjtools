---
title: "The Article Template"
author: Sherry Zhang
output:
    bookdown::html_document2:
      base_format: rmarkdown::html_vignette
vignette: >
  %\VignetteIndexEntry{rjtools-template}
  %\VignetteEngine{knitr::rmarkdown}
  %\VignetteEncoding{UTF-8}
---

```{r, include = FALSE}
knitr::opts_chunk$set(
  collapse = TRUE,
  comment = "#>",
  echo = FALSE,
  warning = FALSE,
  message = FALSE,
)
```

```{r setup, echo = FALSE}
library(rjtools)
library(rmarkdown)
library(palmerpenguins)
library(ggplot2)
library(plotly)
```

This article will work you through the template article created using `create_article()`. We assume that you have follow the "Create an R Journal Article" vignette and are able to knit both the pdf and html article.

# YAML header

# Figure reference

## Static graphic

For a static graph, use `\@ref(fig:penguins)` for in-text reference and your code chunk should look something like this:

````markdown
`r ''````{r penguins, fig.cap="This is the figure caption"}
penguins %>% 
  ggplot(aes(x = flipper_length_mm, y = body_mass_g, 
             color = species)) + 
  geom_point()
```
````

## Interactive graphic

For an interactive graphic, use seperate code chunks to create a static version for the pdf article and an interative version for the html article:

````markdown
`r ''````{r penguins-static, eval=knitr::is_latex_output(), fig.cap="This is the figure caption."}
penguins %>%
  ggplot(aes(x = bill_depth_mm, y = bill_length_mm,
             color = species)) +
  geom_point()
```
````

````markdown
`r ''````{r penguins-interactive, eval=knitr::is_html_output(), fig.cap="This is the figure caption."}
p1 <- penguins %>%
  ggplot(aes(x = bill_depth_mm, y = bill_length_mm,
             color = species)) +
  geom_point()
plotly::ggplotly(p1)
```
````

Notice here you need `eval=knitr::is_html_output()` and `eval=knitr::is_latex_output()` to make sure that pdf output only evaluates the first chunk and html output only evaluates the second chunk. 

For in-text citation, you will something like this: 

    Figure `r "\u0060r"` knitr::asis_output(ifelse(knitr::is_html_output(), '\@ref(fig:penguins-interactive)', '\@ref(fig:penguins-static)'))`r "\u0060"` shows ...
    
This line is quite complicated so let's dissect its components: the if-else statement use `knitr::is_html_output()` to decide if the output is an html or pdf ouput. For an html output, `\@ref(fig:penguins-interactive)` will be used to reference the chunk of the interactive graphic. If the output is pdf (LaTex), `\@ref(fig:penguins-static)` will be used to refer to the static figure. Finally, `knitr::asis_output()` makes sure that the reference string is parsed as it is, so no special treatment on `\@`.

# Template preview

```{r eval = FALSE}
rmarkdown::draft("inst/sample-article",
                 template = here::here("inst/templates/rjournal"),
                 create_dir = TRUE, edit = FALSE)

rmarkdown::render("inst/sample-article/sample-article.Rmd")
```

Here is how the template approximately looks like when rendered as a web article:

```{r}
htmltools::includeHTML(here::here("inst/sample-article/sample-article.html"))
```

The template will also generate a  [pdf](https://github.com/rjournal/rjtools/blob/main/inst/sample-article/RJwrapper.pdf) version.
